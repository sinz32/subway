<html>

<head>
    <meta charset="utf-8">
	<meta name="viewport" content="user-scalable=yes width=device-width" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>실시간 열차 위치</title>
</head>

<style>
html {
	font-size: 20px;
    font-family: NanumBarunGothicLight;
}
body {
	margin: 0px;
}
div.title {
    position: fixed;
	padding: 8px;
	top: 0;
	width: 100%;
    z-index: 4;
	font-size: 1.rem;
	font-weight: bold;
	color: #FFF;
	background-color: #000;
	display: flex;
	align-items: center;
    box-shadow: 0px 4px 5px 0px rgba(0, 0, 0, 0.3);
}
div.title > i {
	padding: 8px;
}
div.title > span {
	padding: 8px;
}
div.drawer {
    position: fixed;
	top: 0;
    margin: 0px;
    background: #EEE;
    height: 100%;
    width: 0px;
    position: fixed;
    transition: 0.3s;
    overflow-x: hidden;
    box-shadow: 0px 20px 20px 0px rgba(0, 0, 0, 0.4);
    z-index: 3;
    white-space: nowrap;
	font-size: 1.1rem;
}
div.drawer > div {
	padding-top: 60px;
}
div.menu {
	padding: 8px;
}
div.submenu {
	padding: 0px 12px;
    display: none;
}
div.menu_item {
	padding: 4px;
	font-size: 1rem;
}

div.body_outer {
	margin: 54px auto 0px;
	padding: 16px;
	max-width: 768px;
}
div.body {
	padding: 16px;
}

line, polyline, polygon {
    stroke-width: 5px;
    stroke-linejoin: round;
    stroke-linecap: round;
}
circle {
    fill: #FFF;
    stroke: #000;
    stroke-width: 2;
}
text {
    font-family: NanumBarunGothic;
}
text.stn {
    text-anchor: middle;
	font-size: 36px;
}
text.terminal {
    text-anchor: middle;
	font-size: 18px;
    font-family: NanumBarunGothic;
}

div.footer {
	padding: 8px;
    font-size: 0.8rem;
    text-align: center;
}
</style>

<body>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css" rel="stylesheet">
	
	<!-- title -->
    <div class='title'>
		<i class="material-icons" id='icon' onclick="openOrClose();">&#xE5D2;</i><span id='title_text'>실시간 전철 위치</span>
	</div>
	
	<!-- drawer -->
	<div class='drawer' id='drawer'>
		
	</div>
	
	<!-- body -->
    <div class='body_outer'>
		<div class='body'>
			<div id='metro_map'>
				상단 왼쪽에 있는 버튼을 눌러서 노선을 선택하세요.
			</div>
		</div>
	</div>
	
	<!-- footer -->
    <div class='footer'>
		<hr>
		© 2018-2025 SinZ, All rights reserved.
	</div>
	
	<script>

const update = {
    tick: -1,
    lineId: null
};
const block = {
    tick: -1
};

function loadData(lineId) {
    var mid = 'sinz'; //크롤러들이 백엔드 요청 주소를 찾지 못하도록 하는 뻘짓
    var end = 'me';
    var url = 'htt'+'ps://' + 'api.' + mid + '.' + end;
	fetch(url + '/met'+'ro?lineId=' + lineId)
		.then((response) => response.json())
		.then((data) => {
			applyData(data, lineId);
			closeDrawer();
		});
}

function applyData(data, lineId) {
	document.getElementById('title_text').innerHTML = data.name + ' 열차 위치 (' + (data.isTimeTable?'시간표':'실시간') + ')';
    update.tick = 20;
    update.lineId = lineId;
	var src;
    if (!isNaN(Number(lineId))) lineId = Number(lineId);
	if (lineId == 101) {
		src = drawLine1(data);
	}
	else if (lineId == 102) {
		src = drawLine2(data);
	}
	else if (lineId == 104) {
		src = drawLine4(data);
	}
	else if (lineId == 105) {
		src = drawLine5(data);
	}
	else if (lineId == 106) {
		src = drawLine6(data);
	}
	else if (lineId == 109) {
		src = drawLine9(data);
	}
	else if (lineId == 121) {
		src = drawLineGU(data);
	}
	else if (lineId == 124) {
		src = drawLineGC(data);
	}
	else if (lineId == 191) {
		src = drawLineGTXA(data);
	}
	else {
		src = drawLine(data, lineId);
	}
	document.getElementById('metro_map').innerHTML = src;
}

function drawLine1(data) {
	var m = 100;
	var src = '<svg viewbox="0 -50 800 8400" >';
	src += '<line x1="50" y1="-20" x2="50" y2="6520" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="8320" stroke="' + data.color + '" />';

    src += '<polyline points="50,4440 100,4490 400,4490 450,4550 450,6550 400,6600 100,6600 50,6650 50,8320" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,4460 700,4510 400,4510 350,4550 350,6520" fill="none" stroke="'+data.color+'" />';
    
    src += '<polyline points="450,4800 500,4850 500,4920" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,4800 700,4850 700,4920" fill="none" stroke="'+data.color+'" />';
    
    src += '<polyline points="450,6200 500,6250 500,6320" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,6200 700,6250 700,6320" fill="none" stroke="'+data.color+'" />';

    data = data.data;
    //연천 ~ 구로
    for(var n=0;n<45;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(50, m*n, data[n].up);
        src += metro_dn(750, m*n, data[n].down);
    }
    //가산디지털단지 ~ 금천구청
    for(var n=45;n<48;n++){
        src += stationR(600, m*n + 100, data[n]);
        src += metro_up(450, m*n + 100, data[n].up);
        src += metro_dn(750, m*n + 100, data[n].down);
    }
    n = 100;
    src += stationR1(600, 4900, data[n]);
    src += metro_up(500, 4900, data[n].up);
    src += metro_dn(700, 4900, data[n].down);
    //석수 ~ 병점
    for(var n=48;n<61;n++){
        src += stationR(600, m*n + 200, data[n]);
        src += metro_up(450, m*n + 200, data[n].up);
        src += metro_dn(750, m*n + 200, data[n].down);
    }
    n = 101;
    src += stationR1(600, 6300, data[n]);
    src += metro_up(500, 6300, data[n].up);
    src += metro_dn(700, 6300, data[n].down);
    //세마 ~ 오산대
    for(var n=61;n<63;n++){
        src += stationR(600, m*n + 300, data[n]);
        src += metro_up(450, m*n + 300, data[n].up);
        src += metro_dn(750, m*n + 300, data[n].down);
    }
    //오산 ~ 신창
    for(var n=63;n<80;n++){
        src += station(400, m*n + 400, data[n]);
        src += metro_up(50, m*n + 400, data[n].up);
        src += metro_dn(750, m*n + 400, data[n].down);
    }

    //구일 ~ 인천
    for(var n=80;n<100;n++){
        src += stationL(200, m*(n-35) + 100, data[n]);
        src += metro_up(50, m*(n-35) + 100, data[n].up);
        src += metro_dn(350, m*(n-35) + 100, data[n].down);
    }

    return src;
}

function drawLine2(data) {
	var m = 100;
	var src = '<svg viewbox="0 -150 800 2900" >';
    
    src += '<polygon points="100,-50 125,-75 675,-75 700,-50 700,2150 675,2175 125,2175 100,2150" fill="none" stroke="'+data.color+'" />';
    src += '<polygon points="50,-50 100,-100 700,-100 750,-50 750,2150 700,2200 100,2200 50,2150" fill="none" stroke="'+data.color+'" />';
    
	src += '<line x1="50" y1="2280" x2="50" y2="2720" stroke="' + data.color + '" />';
	src += '<line x1="350" y1="2280" x2="350" y2="2720" stroke="' + data.color + '" />';
	src += '<line x1="450" y1="2280" x2="450" y2="2720" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="2280" x2="750" y2="2720" stroke="' + data.color + '" />';

    data = data.data;
    data[0].stn += ' (본선)';
    data[23].stn += ' (본선)';
    data[29].stn += ' (지하)';
    //을지로순환선
    for(var n=0;n<22;n++){
        src += stationR2(650, m*n, data[n]);
        src += metro_up(750, m*n, data[n].up);
        src += metro_dn(700, m*n, data[n].down);
    }
    for(var n=22;n<43;n++){
        src += stationL2(150, m*(42-n) + 0, data[n]);
        src += metro_up(100, m*(42-n) + 0, data[n].down);
        src += metro_dn(50, m*(42-n) + 0, data[n].up);
    }
    //성수지선
    for(var n=43;n<48;n++){
        src += stationL(200, m*(n-22) + 200, data[n]);
        src += metro_up(350, m*(n-22) + 200, data[n].up);
        src += metro_dn(50, m*(n-22) + 200, data[n].down);
    }
    //신정지선
    for(var n=48;n<53;n++){
        src += stationR(600, m*(n-27) + 200, data[n]);
        src += metro_up(750, m*(n-27) + 200, data[n].up);
        src += metro_dn(450, m*(n-27) + 200, data[n].down);
    }

    return src;
}

function drawLine4(data) {
	var m = 100;
	var height = m * data.data.length + 1;
	var src = '<svg viewbox="0 -50 800 ' + height + '" >';
    src += '<polyline points="50,-20 50,2830 750,2970 750,' + (height-80) + '" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,-20 750,2830 50,2970 50,' + (height-80) + '" fill="none" stroke="'+data.color+'" />';
    
    data = data.data;
    for(var n=0;n<29;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(750, m*n, data[n].up);
        src += metro_dn(50, m*n, data[n].down);
    }
    for(var n=29;n<data.length;n++){
        src += station(400, m*n + 100, data[n]);
        src += metro_up(50, m*n + 100, data[n].up);
        src += metro_dn(750, m*n + 100, data[n].down);
    }
    
	src += '</svg>';
	return src;
}

function drawLine5(data) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 5000" >';
	src += '<line x1="50" y1="-20" x2="50" y2="4620" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="4920" stroke="' + data.color + '" />';
    src += '<polyline points="50,3840 100,3890 400,3890 450,3950 450,4920" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,3860 700,3910 400,3910 350,3950 350,4620" fill="none" stroke="'+data.color+'" />';
    
    data = data.data;
    //방화 ~ 강동
    for(var n=0;n<39;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(750, m*n, data[n].up);
        src += metro_dn(50, m*n, data[n].down);
    }
    //길동 ~ 하남검단산
    for(var n=39;n<49;n++){
        src += stationR(600, m*n + 100, data[n]);
        src += metro_up(750, m*n + 100, data[n].up);
        src += metro_dn(450, m*n + 100, data[n].down);
    }
    //둔촌동 ~ 마천
    for(var n=49;n<56;n++){
        src += stationL(200, m*(n-9), data[n]);
        src += metro_up(350, m*(n-9), data[n].up);
        src += metro_dn(50, m*(n-9), data[n].down);
    }
	src += '</svg>';
	return src;
}

function drawLine6(data) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -80 800 3730" >';
    src += '<polyline points="50,3620 50,-30 90,-70 710,-70 750,-30 750,3620" fill="none" stroke="'+data.color+'" />';

    data = data.data;
    src += stationR(600, 100, data[0], {right: true});
    src += metro_up(750, 100, data[0].down);
    //src += metro_dn(450, 100, data[0].up);
    src += stationR(600, 0, data[1], {right: true});
    src += metro_up(750, 0, data[1].down);
    //src += metro_dn(450, 0, data[1].up);
    for(var n=2;n<5;n++){
        src += stationL(200, m*(n-2), data[n], {left: true});
        //src += metro_up(350, m*(n-2), data[n].up);
        src += metro_dn(50, m*(n-2), data[n].down);
    }
    for(var n=5;n<data.length;n++){
        src += station(400, m*(n-2), data[n]);
        src += metro_up(750, m*(n-2), data[n].up);
        src += metro_dn(50, m*(n-2), data[n].down);
    }
	src += '</svg>';
	return src;
}

function drawLine9(data, lineId) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 ' + height + '" >';
	src += '<line x1="50" y1="-20" x2="50" y2="' + (height-80) + '" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="' + (height-80) + '" stroke="' + data.color + '" />';
    var express = ['김포공항', '마곡나루', '가양', '염창', '당산', '여의도', '노량진', '동작', '고속터미널', '신논현', '선정릉', '봉은사', '종합운동장', '석촌', '올림픽공원', '중앙보훈병원'];
    data.data.forEach((e, i) => {
		src += station(400, m*i, e, express.includes(e.stn)?'#FF1744':null);
		src += metro_up(750, m*i, e.up);
		src += metro_dn(50, m*i, e.down);
	});
	src += '</svg>';
	return src;
}

function drawLineGU(data) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 5800" >';
	src += '<line x1="50" y1="-20" x2="50" y2="5720" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="5720" stroke="' + data.color + '" />';
    src += '<polyline points="50,2200 150,2300 150,2420" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,2200 650,2300 650,2420" fill="none" stroke="'+data.color+'" />';
    
    src += text(400, 50, '(도라산행 열차 1달에 1왕복 운행)', 24, "#424242", 'middle');

    data = data.data;
    for(var n=0;n<23;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(50, m*n, data[n].up);
        src += metro_dn(750, m*n, data[n].down);
    }
    for(var n=23;n<25;n++){
        src += stationK(400, m*n, data[n]);
        src += metro_up(150, m*n, data[n].up);
        src += metro_dn(650, m*n, data[n].down);
    }
    for(var n=25;n<data.length;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(50, m*n, data[n].up);
        src += metro_dn(750, m*n, data[n].down);
    }
    
	src += '</svg>';
	return src;
}

function drawLineGC(data) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 3200" >';
	src += '<line x1="50" y1="700" x2="50" y2="3120" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="700" x2="750" y2="3120" stroke="' + data.color + '" />';
	src += '<line x1="50" y1="-20" x2="50" y2="700" stroke="#77C4A3" />';
	src += '<line x1="750" y1="-20" x2="750" y2="700" stroke="#77C4A3" />';
    src += '<polyline points="50,1100 150,1000 150,980" fill="none" stroke="'+data.color+'" />';
    src += '<polyline points="750,1100 650,1000 650,980" fill="none" stroke="'+data.color+'" />';
    
    src += text(400, 650, '(ITX-청춘만 경의·중앙선 직결운행)', 24, "#77C4A3", 'middle');

    data = data.data;
    for(var n=0;n<10;n++){
        src += station(400, m*n, data[n]);
        src += metro_up(50, m*n, data[n].up);
        src += metro_dn(750, m*n, data[n].down);
    }
    src += stationK(400, m*n, data[31]);
    src += metro_up(150, m*n, data[31].up);
    src += metro_dn(650, m*n, data[31].down);
    for(var n=10;n<data.length - 1;n++){
        src += station(400, m*n + 100, data[n]);
        src += metro_up(50, m*n + 100, data[n].up);
        src += metro_dn(750, m*n + 100, data[n].down);
    }
    
	src += '</svg>';
	return src;
}

function drawLineGTXA(data) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 ' + height + '" >';
	src += '<line x1="50" y1="-20" x2="50" y2="500" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="500" stroke="' + data.color + '" />';
	src += '<line x1="50" y1="700" x2="50" y2="' + (height-80) + '" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="700" x2="750" y2="' + (height-80) + '" stroke="' + data.color + '" />';
    
    src += text(400, 650, '(서울역 ~ 수서역 구간 선로 없음)', 24, "#424242", 'middle');

    data.data.forEach((e, i) => {
		src += station(400, m*i, e);
		src += metro_up(50, m*i, e.up);
		src += metro_dn(750, m*i, e.down);
	});
    
	src += '</svg>';
	return src;
}

function drawLine(data, lineId) {
	var m = 100;
	var height = m * data.data.length;
	var src = '<svg viewbox="0 -50 800 ' + height + '" >';
	src += '<line x1="50" y1="-20" x2="50" y2="' + (height-80) + '" stroke="' + data.color + '" />';
	src += '<line x1="750" y1="-20" x2="750" y2="' + (height-80) + '" stroke="' + data.color + '" />';
    if ([103, 107, 108, 125, 126, 127, 130, 131, 151, 152,
            201, 202, 203, 204, 301, 401, 402, 403, 501].includes(lineId)) data.data.forEach((e, i) => {
		src += station(400, m*i, e);
		src += metro_up(750, m*i, e.up);
		src += metro_dn(50, m*i, e.down);
	});
    else data.data.forEach((e, i) => {
		src += station(400, m*i, e);
		src += metro_up(50, m*i, e.up);
		src += metro_dn(750, m*i, e.down);
	});
    
	src += '</svg>';
	return src;
}

function station(x, y, data, color){
    if (color==undefined) {
        if (data.stn.endsWith('(미정차)') || data.stn.endsWith('(미개통)') || data.stn.endsWith('(운행 중단)')) color = '#777';
        else color = '#000';
    }

    var cx = x + 0;
    var cy = y;
    var circle = '<circle cx="'+(cx-350)+'" cy="'+cy+'" r="9"/><circle cx="'+(cx+350)+'" cy="'+cy+'" r="9"/>';
	var json = JSON.stringify(data);
	return '<line x1="50" y1="'+cy+'" x2="150" y2="' + cy + '" stroke="#EEE" />' + 
        '<line x1="650" y1="'+cy+'" x2="750" y2="' + cy + '" stroke="#EEE" />' + 
        '<text class="stn" x='+x+' y='+(y+12)+' fill='+color+' onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationL(x, y, data, noCircle){
    var cx = x + 0;
    var cy = y;
    var circle = '<circle cx="'+(cx-150)+'" cy="'+cy+'" r="9"/>' + 
        '<circle cx="'+(cx+150)+'" cy="'+cy+'" r="9"/>';
    if (noCircle) {
        circle = '';
        if(noCircle.left) circle += '<circle cx="'+(cx-150)+'" cy="'+cy+'" r="9"/>'
        if(noCircle.right) circle += '<circle cx="'+(cx+150)+'" cy="'+cy+'" r="9"/>'
    }
	var json = JSON.stringify(data);
	return '<line x1="50" y1="'+cy+'" x2="100" y2="' + cy + '" stroke="#EEE" />' + 
        '<line x1="300" y1="'+cy+'" x2="350" y2="' + cy + '" stroke="#EEE" />' + 
        '<text class="stn" x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationR(x, y, data, noCircle){
    var cx = x + 0;
    var cy = y;
    var circle = '<circle cx="'+(cx-150)+'" cy="'+cy+'" r="9"/>' + 
        '<circle cx="'+(cx+150)+'" cy="'+cy+'" r="9"/>';
    if (noCircle) {
        circle = '';
        if(noCircle.left) circle += '<circle cx="'+(cx-150)+'" cy="'+cy+'" r="9"/>'
        if(noCircle.right) circle += '<circle cx="'+(cx+150)+'" cy="'+cy+'" r="9"/>'
    }
	var json = JSON.stringify(data);
	return '<line x1="450" y1="'+cy+'" x2="500" y2="' + cy + '" stroke="#EEE" />' + 
        '<line x1="700" y1="'+cy+'" x2="750" y2="' + cy + '" stroke="#EEE" />' + 
        '<text class="stn" x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationR1(x, y, data, noCircle){
    var cx = x + 0;
    var cy = y;
    var circle = '<circle cx="'+(cx-100)+'" cy="'+cy+'" r="9"/>' + 
        '<circle cx="'+(cx+100)+'" cy="'+cy+'" r="9"/>';
	var json = JSON.stringify(data);
	return '<line x1="500" y1="'+cy+'" x2="550" y2="' + cy + '" stroke="#EEE" />' + 
        '<line x1="650" y1="'+cy+'" x2="700" y2="' + cy + '" stroke="#EEE" />' + 
        '<text class="stn" x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationL2(x, y, data){
    var circle = '<circle cx="'+(x-100)+'" cy="'+y+'" r="9"/>' + 
        '<circle cx="'+(x-50)+'" cy="'+y+'" r="9"/>';
	var json = JSON.stringify(data);
	return '<line x1="'+(x-100)+'" y1="'+y+'" x2="'+(x-20)+'" y2="' + y + '" stroke="#EEE" />' +
        '<text class="stn" style=\'text-anchor: start;\'; x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationR2(x, y, data){
    var circle = '<circle cx="'+(x+50)+'" cy="'+y+'" r="9"/>' + 
        '<circle cx="'+(x+100)+'" cy="'+y+'" r="9"/>';
	var json = JSON.stringify(data);
	return '<line x1="'+(x+100)+'" y1="'+y+'" x2="'+(x+20)+'" y2="' + y + '" stroke="#EEE" />' + 
        '<text class="stn" style=\'text-anchor: end;\'; x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function stationK(x, y, data, noCircle){
    var cx = x + 0;
    var cy = y;
    var circle = '<circle cx="'+(cx-250)+'" cy="'+cy+'" r="9"/>' + 
        '<circle cx="'+(cx+250)+'" cy="'+cy+'" r="9"/>';
	var json = JSON.stringify(data);
	return '<line x1="150" y1="'+cy+'" x2="300" y2="' + cy + '" stroke="#EEE" />' + 
        '<line x1="500" y1="'+cy+'" x2="650" y2="' + cy + '" stroke="#EEE" />' + 
        '<text class="stn" x='+x+' y='+(y+12)+' fill=#000 onclick=\'showTrainInfo('+json+');\'>'+data.stn+'</text>'
        + circle;
}

function metro_up(x, y, data){
if(data.length == 0) return '';
x -= 14;
y -= 24;
var result = "";
data.forEach((e, i) => { //열차 아이콘 배치
var px = x, py = y;
if (data.length > 1) {
	if (i == 0) px -= 6;
	else px += 6;
}
if (e.sts == '출발' || e.sts == '통과') py -= 30;
if (e.sts == '접근' || e.sts == '진입') py += 30;
var f = '';
if (e.type != null) f = '_rapid';
if (e.type == 'ITX-청춘') f = '_itx';
var file = "'./images/up" + f + ".svg'";
result += "<image xlink:href=" + file + " x='" + px + "' y='" + py + "' width='28px'/>";
});
data.forEach((e, i) => { //행선지 글자 배치
var px = x, py = y;
if (data.length > 1) {
	if (i == 0) px -= 6;
	else px += 6;
}
if (e.sts == '출발' || e.sts == '통과') py -= 30;
if (e.sts == '접근' || e.sts == '진입') py += 30;
result += terminal(e, px, py, 3);
});
return result;
}

function metro_dn(x, y, data){
if(data.length == 0) return '';
x -= 14;
y -= 24;
var result = "";
data.forEach((e, i) => { //열차 아이콘 배치
var px = x, py = y;
if (data.length > 1) {
	if (i == 0) px -= 6;
	else px += 6;
}
if (e.sts == '출발' || e.sts == '통과') py += 30;
if (e.sts == '접근' || e.sts == '진입') py -= 30;
var f = '';
if (e.type != null) f = '_rapid';
if (e.type == 'ITX-청춘') f = '_itx';
var file = "'./images/down" + f + ".svg'";
result += "<image xlink:href=" + file + " x='" + px + "' y='" + py + "' width='28px'/>";
});
data.forEach((e, i) => { //행선지 글자 배치
var px = x, py = y;
if (data.length > 1) {
	if (i == 0) px -= 6;
	else px += 6;
}
if (e.sts == '출발' || e.sts == '통과') py += 30;
if (e.sts == '접근' || e.sts == '진입') py -= 30;
result += terminal(e, px, py, 1);
});
return result;
}

function text(x, y, txt, size, color, align) {
if(color==undefined) color = '#000';
var css = 'font-size: '+size+'px;';
if (align) css += ' text-anchor: ' + align + ';'
return '<text class=line_name x=' + x + ' y=' + y + ' fill='+color+' style="' + css + '">'+txt+'</text>';
}

function terminal(e, x, y, dy) {
if (e.terminal == null) return '';
var terminal = e.terminal;
if (e.terminal.includes('(')) terminal = e.terminal.split('(')[0].trim();
x += 14;
y += 30 + dy;

if (terminal == '내선순환') terminal = '내선';
else if (terminal == '외선순환') terminal = '외선';
else if (terminal.length > 3) terminal = e.terminal.slice(0, 2) + '︙';
switch(terminal.length) {
    case 1:
        return '<text class=terminal x='+x+' y='+y+' fill=#E0E0E0>'+terminal+'</text>';
    case 2:
        return '<text class=terminal x='+x+' y='+(y-9)+' fill=#E0E0E0>'+terminal[0]+'</text>'
            + '<text class=terminal x='+x+' y='+(y+9)+' fill=#E0E0E0>'+terminal[1]+'</text>';
    case 3:
        return '<text class=terminal x='+x+' y='+(y-17)+' fill=#E0E0E0>'+terminal[0]+'</text>'
            + '<text class=terminal x='+x+' y='+y+' fill=#E0E0E0>'+terminal[1]+'</text>'
            + '<text class=terminal x='+x+' y='+(y+17)+' fill=#E0E0E0>'+terminal[2]+'</text>';
}
return '';
}


const LineList = [{
    "name" : "수도권 전철",
    "child" : true,
    "data": [
        {
            "name" : "수도권 1호선",
            "id" : "101"
        }, {
            "name" : "서울 2호선",
            "id" : "102"
        }, {
            "name" : "수도권 3호선",
            "id" : "103"
        }, {
            "name" : "수도권 4호선",
            "id" : "104"
        }, {
            "name" : "수도권 5호선",
            "id" : "105"
        }, {
            "name" : "서울 6호선",
            "id" : "106"
        }, {
            "name" : "서울 7호선",
            "id" : "107"
        }, {
            "name" : "수도권 8호선",
            "id" : "108"
        }, {
            "name" : "서울 9호선",
            "id" : "109"
        }, {
            "name" : "경의·중앙선",
            "id" : "121"
        }, {
            "name" : "수인·분당선",
            "id" : "122"
        }, {
            "name" : "신분당선",
            "id" : "123"
        }, {
            "name" : "경춘선",
            "id" : "124"
        }, {
            "name" : "우이신설선",
            "id" : "125"
        }, {
            "name" : "용인경전철",
            "id" : "126"
        }, {
            "name" : "의정부경전철",
            "id" : "127"
        }, {
            "name" : "경강선",
            "id" : "128"
        }, {
            "name" : "서해선",
            "id" : "129"
        }, {
            "name" : "김포골드라인",
            "id" : "130"
        }, {
            "name" : "신림선",
            "id" : "131"
        }, {
            "name" : "공항철도",
            "id" : "132"
        }, {
            "name" : "인천 1호선",
            "id" : "151"
        }, {
            "name" : "인천 2호선",
            "id" : "152"
        }, {
            "name" : "GTX-A",
            "id" : "191"
        }
    ]
}, {
    "name" : "동남권 광역전철",
    "child" : true,
    "data": [
        {
            "name" : "부산 1호선",
            "id" : "201"
        }, {
            "name" : "부산 2호선",
            "id" : "202"
        }, {
            "name" : "부산 3호선",
            "id" : "203"
        }, {
            "name" : "부산 4호선",
            "id" : "204"
        }, {
            "name" : "동해선",
            "id" : "251"
        }, {
            "name" : "부산김해경전철",
            "id" : "252"
        }
    ]
}, {
    "name" : "대전 도시철도",
    "child" : false,
    "data": ["301"]
}, {
    "name" : "대구권 전철",
    "child" : true,
    "data" : [
        {
            "name" : "대구 1호선",
            "id" : "401"
        }, {
            "name" : "대구 2호선",
            "id" : "402"
        }, {
            "name" : "대구 3호선",
            "id" : "403"
        }, {
            "name" : "대경선",
            "id" : "451"
        }
    ]
}, {
    "name" : "광주 도시철도",
    "child" : false,
    "data": ["501"]
}];
(function(){
var src = '<div>';
LineList.forEach((e, i) => {
	src += '<div class=\'menu\'>';
	if (e.child) {
		src += '<div class=\'menu_title\' onclick="expandMenu(this)">' + e.name + '</div>';
		src += '<div class=\'submenu\'>';
		for(var n=0;n<e.data.length;n++) {
			src += '<div class=menu_item onclick="loadData(\'' + e.data[n].id + '\');"> - ' + e.data[n].name + '</div>';
		}
		src += '</div>';
	} else {
		src += '<div class=\'menu_title\' onclick="loadData(\'' + e.data[0] + '\')">' + e.name + '</div>';
	}
	src += '</div>';
});
src += '<div class=\'menu\'>';
src += '<div class=\'menu_title\' onclick="location.href=\'https://sinz.me/\';">개발자 홈페이지</div>';
src += '</div>';
document.getElementById("drawer").innerHTML = src + '</div>';
})();

var isOpened = false;
function openOrClose(btn){
	isOpened ? closeDrawer() : openDrawer();
}

function openDrawer() {
	document.getElementById("drawer").style.width = "73%";
	isOpened = true;
}

function closeDrawer() {
	document.getElementById("drawer").style.width = "0";
	isOpened = false;
}

function expandMenu(e) {
    e = e.parentElement.children[1];
    if (e.style.display == 'block') e.style.display = 'none';
    else e.style.display = 'block';
}

setInterval(()=>{
    if (update.tick > 0) update.tick--;
    if (update.tick == 0) {
        update.tick = 20;
        loadData(update.lineId);
    }


}, 1000);
</script>
</body>

</html>
